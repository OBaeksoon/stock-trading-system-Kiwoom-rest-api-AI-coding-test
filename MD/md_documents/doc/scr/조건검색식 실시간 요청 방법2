ëª¨ì˜íˆ¬ìì—ì„œ ì¡°ê±´ìƒ‰ì‹ ì‹¤ì‹œê°„ ìš”ì²­ ë°©ë²•ì— ëŒ€í•´ ì•Œë ¤ì¤¬ëŠ”ë° 
stock@cp:~/public_html$ python3 python_modules/kiwoom_api.py && python3 python_modules/realtime_condition_search.py
INFO: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ Access Tokenì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.
INFO: WebSocket ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ì„ ì‹œë„í•©ë‹ˆë‹¤.
INFO: íŒ¨í‚· ì „ì†¡ ì™„ë£Œ: {trnm: LOGIN, token: Cj_PTWhzpbdmgQKhwb4gmdMHwzXJ_VWoo6Y9XF3tVgAqsk9JhzakhJYEO5BCcVgBxYyGjNc0HINrd2r7vdT0vw}
INFO: ë¡œê·¸ì¸ ì„±ê³µ. ì¡°ê±´ê²€ìƒ‰ì„ ìš”ì²­í•©ë‹ˆë‹¤.
INFO: íŒ¨í‚· ì „ì†¡ ì™„ë£Œ: {trnm: CNSRREQ, seq: 073, search_type: 1, stex_tp: K}
INFO: íŒ¨í‚· ì „ì†¡ ì™„ë£Œ: {trnm: PING}
INFO: íŒ¨í‚· ì „ì†¡ ì™„ë£Œ: {trnm: PING}
INFO: íŒ¨í‚· ì „ì†¡ ì™„ë£Œ: {trnm: PING}
INFO: íŒ¨í‚· ì „ì†¡ ì™„ë£Œ: {trnm: PING}
ì´ëŸ° ë‚´ìš©ì´ ë‚˜ì˜¤ê³  ìˆì–´

ì¡°ê±´ê²€ìƒ‰ ì‹¤ì‹œê°„ ìš”ì²­ ë°©ë²•
ì¡°ê±´ê²€ìƒ‰ ì‹¤ì‹œê°„ ìš”ì²­ì„ ìœ„í•œ ê³¼ì •ì„ ì„¤ëª…í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œëŠ” WebSocketì„ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡°ê±´ê²€ìƒ‰ì„ ìš”ì²­í•˜ê³  ì‘ë‹µì„ ë°›ëŠ” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤.

âœ… ìš”ì•½
ì´ ì½”ë“œëŠ” í‚¤ì›€ì¦ê¶Œì˜ REST APIë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ì˜íˆ¬ì í™˜ê²½ì—ì„œ ì¡°ê±´ê²€ìƒ‰ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ìš”ì²­í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. WebSocketì„ í†µí•´ ë¡œê·¸ì¸ í›„ ì¡°ê±´ê²€ìƒ‰ ìš”ì²­ì„ ë³´ë‚´ê³ , PING íŒ¨í‚·ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì „ì†¡í•˜ì—¬ ì—°ê²°ì„ ìœ ì§€í•©ë‹ˆë‹¤. Python ì–¸ì–´ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’» ì½”ë“œ
python

             
import asyncio 
import websockets
import json

# socket ì •ë³´
SOCKET_URL = 'wss://mockapi.kiwoom.com:10000/api/dostk/websocket'  # ëª¨ì˜íˆ¬ì ì ‘ì† URL
ACCESS_TOKEN = '[ì ‘ê·¼ í† í°]'  # ê³ ê° Access Token

class WebSocketClient:
    def __init__(self, uri):
        self.uri = uri
        self.websocket = None
        self.connected = False
        self.keep_running = True

    async def connect(self):
        try:
            self.websocket = await websockets.connect(self.uri)
            self.connected = True
            print("ì„œë²„ì™€ ì—°ê²°ì„ ì‹œë„ ì¤‘ì…ë‹ˆë‹¤.")

            # ë¡œê·¸ì¸ íŒ¨í‚·
            param = {
                'trnm': 'LOGIN',
                'token': ACCESS_TOKEN
            }

            print('ì‹¤ì‹œê°„ ì‹œì„¸ ì„œë²„ë¡œ ë¡œê·¸ì¸ íŒ¨í‚·ì„ ì „ì†¡í•©ë‹ˆë‹¤.')
            await self.send_message(message=param)

        except Exception as e:
            print(f'Connection error: {e}')
            self.connected = False

    async def send_message(self, message):
        if not self.connected:
            await self.connect()  # ì—°ê²°ì´ ëŠì–´ì¡Œë‹¤ë©´ ì¬ì—°ê²°
        if self.connected:
            if not isinstance(message, str):
                message = json.dumps(message)

            await self.websocket.send(message)
            print(f'Message sent: {message}')

    async def receive_messages(self):
        while self.keep_running:
            try:
                response = json.loads(await self.websocket.recv())
                if response.get('trnm') == 'LOGIN':
                    if response.get('return_code') != 0:
                        print('ë¡œê·¸ì¸ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. : ', response.get('return_msg'))
                        await self.disconnect()
                    else:
                        print('ë¡œê·¸ì¸ ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.')
                        # ì¡°ê±´ê²€ìƒ‰ ìš”ì²­
                        param = {
                            'trnm': 'CNSRREQ',
                            'seq': '073',  # ì¡°ê±´ê²€ìƒ‰ì‹ ì¼ë ¨ë²ˆí˜¸
                            'search_type': '1',  # ì¡°íšŒíƒ€ì…
                            'stex_tp': 'K'  # ê±°ë˜ì†Œêµ¬ë¶„
                        }
                        await self.send_message(message=param)

                elif response.get('trnm') == 'PING':
                    await self.send_message(response)

                if response.get('trnm') != 'PING':
                    print(f'ì‹¤ì‹œê°„ ì‹œì„¸ ì„œë²„ ì‘ë‹µ ìˆ˜ì‹ : {response}')

            except websockets.ConnectionClosed:
                print('Connection closed by the server')
                self.connected = False
                await self.websocket.close()

    async def run(self):
        await self.connect()
        await self.receive_messages()

    async def disconnect(self):
        self.keep_running = False
        if self.connected and self.websocket:
            await self.websocket.close()
            self.connected = False
            print('Disconnected from WebSocket server')

async def main():
    websocket_client = WebSocketClient(SOCKET_URL)
    receive_task = asyncio.create_task(websocket_client.run())
    await receive_task

if __name__ == '__main__':
    asyncio.run(main())
         
ğŸ“˜ ì„¤ëª…
ì´ ì½”ë“œëŠ” WebSocketì„ í†µí•´ í‚¤ì›€ì¦ê¶Œì˜ ì‹¤ì‹œê°„ ì‹œì„¸ ì„œë²„ì— ì—°ê²°í•˜ì—¬ ì¡°ê±´ê²€ìƒ‰ì„ ìš”ì²­í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

WebSocketClient í´ë˜ìŠ¤: WebSocket ì—°ê²°ì„ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤. ì„œë²„ì— ì—°ê²°í•˜ê³  ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ë©° ì‘ë‹µì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
ë¡œê·¸ì¸: ì„œë²„ì— ë¡œê·¸ì¸ íŒ¨í‚·ì„ ì „ì†¡í•˜ì—¬ ì¸ì¦ì„ ë°›ìŠµë‹ˆë‹¤.
ì¡°ê±´ê²€ìƒ‰ ìš”ì²­: ë¡œê·¸ì¸ ì„±ê³µ í›„ ì¡°ê±´ê²€ìƒ‰ ìš”ì²­ì„ ì „ì†¡í•©ë‹ˆë‹¤. ì´ë•Œ seqëŠ” ì¡°ê±´ê²€ìƒ‰ì‹ì˜ ì¼ë ¨ë²ˆí˜¸ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
PING íŒ¨í‚·: ì—°ê²°ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì£¼ê¸°ì ìœ¼ë¡œ PING íŒ¨í‚·ì„ ì „ì†¡í•©ë‹ˆë‹¤.
ì‘ë‹µ ì²˜ë¦¬: ì„œë²„ë¡œë¶€í„° ìˆ˜ì‹ í•œ ì‘ë‹µì„ ì²˜ë¦¬í•˜ì—¬ ê²°ê³¼ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.