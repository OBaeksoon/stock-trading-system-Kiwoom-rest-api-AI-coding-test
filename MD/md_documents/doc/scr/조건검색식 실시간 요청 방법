ì¡°ê±´ê²€ìƒ‰ì‹ ì‹¤ì‹œê°„ ìš”ì²­ ë°©ë²•
ì¡°ê±´ê²€ìƒ‰ì‹ ì‹¤ì‹œê°„ ìš”ì²­ì„ ìœ„í•´ì„œëŠ” WebSocketì„ í†µí•´ í‚¤ì›€ì¦ê¶Œì˜ ì‹¤ì‹œê°„ ì‹œì„¸ ì„œë²„ì— ì—°ê²°í•˜ê³ , ì¡°ê±´ê²€ìƒ‰ì‹ ì¼ë ¨ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ë¡œê·¸ì¸ í›„ ì¡°ê±´ê²€ìƒ‰ ìš”ì²­ì„ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.

âœ… ìš”ì•½
ì´ ì½”ë“œëŠ” í‚¤ì›€ì¦ê¶Œì˜ WebSocket APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°ê±´ê²€ìƒ‰ì‹ ì‹¤ì‹œê°„ ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” ì˜ˆì œìž…ë‹ˆë‹¤. ì‚¬ìš©ìžëŠ” WebSocket ì„œë²„ì— ì—°ê²°í•˜ê³  ë¡œê·¸ì¸í•œ í›„, íŠ¹ì • ì¡°ê±´ê²€ìƒ‰ì‹ì˜ ì¼ë ¨ë²ˆí˜¸ë¥¼ í†µí•´ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤. Python ì–¸ì–´ë¡œ ìž‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

ðŸ’» ì½”ë“œ
import asyncio 
import websockets
import json

# socket ì •ë³´
SOCKET_URL = 'wss://api.kiwoom.com:10000/api/dostk/websocket'  # ì ‘ì† URL
ACCESS_TOKEN = '[ì ‘ê·¼ í† í°]'  # ê³ ê° Access Token

class WebSocketClient:
    def __init__(self, uri):
        self.uri = uri
        self.websocket = None
        self.connected = False
        self.keep_running = True

    async def connect(self):
        try:
            self.websocket = await websockets.connect(self.uri)
            self.connected = True
            print("ì„œë²„ì™€ ì—°ê²°ì„ ì‹œë„ ì¤‘ìž…ë‹ˆë‹¤.")

            param = {
                'trnm': 'LOGIN',
                'token': ACCESS_TOKEN
            }

            print('ì‹¤ì‹œê°„ ì‹œì„¸ ì„œë²„ë¡œ ë¡œê·¸ì¸ íŒ¨í‚·ì„ ì „ì†¡í•©ë‹ˆë‹¤.')
            await self.send_message(message=param)

        except Exception as e:
            print(f'Connection error: {e}')
            self.connected = False

    async def send_message(self, message):
        if not self.connected:
            await self.connect()
        if self.connected:
            if not isinstance(message, str):
                message = json.dumps(message)

            await self.websocket.send(message)
            print(f'Message sent: {message}')

    async def receive_messages(self):
        while self.keep_running:
            try:
                response = json.loads(await self.websocket.recv())

                if response.get('trnm') == 'LOGIN':
                    if response.get('return_code') != 0:
                        print('ë¡œê·¸ì¸ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. : ', response.get('return_msg'))
                        await self.disconnect()
                    else:
                        print('ë¡œê·¸ì¸ ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.')
                        print('ì¡°ê±´ê²€ìƒ‰ ìš”ì²­ íŒ¨í‚·ì„ ì „ì†¡í•©ë‹ˆë‹¤.')
                        param = {
                            'trnm': 'CNSRREQ',
                            'seq': '4',  # ì¡°ê±´ê²€ìƒ‰ì‹ ì¼ë ¨ë²ˆí˜¸
                            'search_type': '1',  # ì¡°íšŒíƒ€ìž…
                            'stex_tp': 'K',  # ê±°ëž˜ì†Œêµ¬ë¶„
                        }
                        await self.send_message(message=param)

                elif response.get('trnm') == 'PING':
                    await self.send_message(response)

                if response.get('trnm') != 'PING':
                    print(f'ì‹¤ì‹œê°„ ì‹œì„¸ ì„œë²„ ì‘ë‹µ ìˆ˜ì‹ : {response}')

            except websockets.ConnectionClosed:
                print('Connection closed by the server')
                self.connected = False
                await self.websocket.close()

    async def run(self):
        await self.connect()
        await self.receive_messages()

    async def disconnect(self):
        self.keep_running = False
        if self.connected and self.websocket:
            await self.websocket.close()
            self.connected = False
            print('Disconnected from WebSocket server')

async def main():
    websocket_client = WebSocketClient(SOCKET_URL)
    receive_task = asyncio.create_task(websocket_client.run())
    await receive_task

if __name__ == '__main__':
    asyncio.run(main())

ðŸ“˜ ì„¤ëª…
ì´ ì½”ë“œëŠ” WebSocketì„ í†µí•´ í‚¤ì›€ì¦ê¶Œì˜ ì‹¤ì‹œê°„ ì‹œì„¸ ì„œë²„ì— ì—°ê²°í•˜ì—¬ ì¡°ê±´ê²€ìƒ‰ì‹ì˜ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì‚¬ìš©ìžëŠ” ë¨¼ì € ì„œë²„ì— ë¡œê·¸ì¸í•˜ê³ , ë¡œê·¸ì¸ ì„±ê³µ í›„ ì¡°ê±´ê²€ìƒ‰ì‹ì˜ ì¼ë ¨ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤. ì‘ë‹µìœ¼ë¡œëŠ” ì‹¤ì‹œê°„ ë°ì´í„°ê°€ ìˆ˜ì‹ ë˜ë©°, ì´ë¥¼ í†µí•´ ì£¼ì‹ì˜ ì‹¤ì‹œê°„ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ðŸ”— ì¶”ì²œ API
APIë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤. í•„ìš”í•œ ê¸°ëŠ¥ì— ë§žê²Œ ì„ íƒí•˜ì—¬ ì‚¬ìš©í•´ë³´ì„¸ìš”!

ka10174: êµ­ë‚´ì£¼ì‹ > ì¡°ê±´ê²€ìƒ‰ > ì¡°ê±´ê²€ìƒ‰ ì‹¤ì‹œê°„ í•´ì œ

ka10173: êµ­ë‚´ì£¼ì‹ > ì¡°ê±´ê²€ìƒ‰ > ì¡°ê±´ê²€ìƒ‰ ìš”ì²­ ì‹¤ì‹œê°„