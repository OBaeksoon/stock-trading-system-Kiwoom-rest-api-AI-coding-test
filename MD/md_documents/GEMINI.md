모든 답변은 한국어로 한다.
주식 자동매매 시스템 개발 계획 (GEMINI.md)
모든 작업을 하기전 Git 서버에 저장된 내용을 확인 하고 진행한다.
기능을 새로작성 되고 업데이트 되면 웹페이지 index.php와 연결 되여야 한다.
웹페이지에서 메인 페이지로 가기 버튼을 고정 위치로 변경하여 스크롤해도 항상 보이도록 
MD폴더 안에 있는 파일들은 참고용으로 사용하여 본 프로젝트에 적용한다.
작업이 완료 되면 Git 서버에 저장하고 README.md 에 업데이트 한다.

작동하지 않은 페이지 : 
- http://stock.mizrino.com/display_all_stocks.php
- http://stock.mizrino.com/display_technical_analysis.php 종목을 검색하면 해당 결과물이 나오지 않음
- http://stock.mizrino.com/view_stock_chart.php 실 데이터와 괴리가 있음 문제점을 찾아야함.


1. 프로젝트 개요 및 목표
본 프로젝트는 키움증권 REST API를 활용하여 주식 자동매매 시스템을 구축하는 것을 목표로 합니다. 핵심 목표는 손실 최소화 및 수익 최대화이며, 이를 위해 Python 기반의 자동매매 로직과 PHP 기반의 웹 인터페이스를 연동하여 실시간 모니터링 및 제어 기능을 제공합니다.
작업 내용 저장: 지금까지 작업한 내용을 저장하는 파일 및 폴더 구조 관리.
사용 설명서 파일: 사용설명서 저장
웹서치을 최대한 자제한다.

2. 기술 스택
자동매매 로직: Python (pyheroapi 라이브러리 활용)

웹 인터페이스: PHP, HTML, CSS, JavaScript

API 연동: 키움증권 REST API

데이터베이스: MySQL (필요한 데이터 저장)
데이터베이스에는 기본적으로 APP_KEY, APP_SECRET 가 저장되여 있다.


3. 주요 기능 및 개발 내용
본 프로젝트는 `pyheroapi` 라이브러리를 활용하여 키움증권 REST API와의 연동을 효율적으로 처리하고, 다양한 주식 데이터를 수집 및 분석합니다.
3.1. 자동매매 로직 (Python)
매매 시간 관리:

정규 자동매매 시간: 09:00 ~ 15:00 (급등주 매매시간 초과 종목 포함)

급등주 매매 시간: 09:00 ~ 09:20

**미국 주식 분석 (데이터베이스 연동 완료):**

*   **데이터 수집**: `us_top_gainers_scraper.py`를 통해 상승률 상위 종목을 스크래핑하여 데이터베이스(`us_top_gainers` 테이블)에 저장합니다.
*   **상세 정보 및 뉴스 분석**: `us_stock_analyzer.py`가 데이터베이스에서 종목 목록을 가져와 `yfinance` 라이브러리를 통해 각 종목의 상세 정보(섹터, 산업)와 최신 뉴스를 수집합니다.
*   **데이터 저장**: 수집된 상세 정보는 `us_top_gainers` 테이블에 업데이트하고, 관련 뉴스는 `us_stock_news` 테이블에 저장하여 체계적으로 관리합니다.
*   **레거시 지원**: `korean_stock_finder.py`와의 호환성을 위해 분석 결과를 `us_top_gainers_info_and_news.json` 파일로도 생성합니다.

국내 주식 분석:
1. 이동평균선을 이용한 분석 : 5일 이평선, 10일 이평선을 4일 이상 이탈하지 않은 종목 검색
2. 급등주 검색: 전일 거래량 대비 50% 이상 상승한 종목 검색
3. md_documents 폴더에 있는 '급등주거래량.txt' 파일을 참고하여 거래량 법칙 적용
5. md_documents 폴더에 있는 '거래량 법칙.txt' 파일을 참고하여 거래량 법칙 적용
6. md_documents 폴더에 있는 '호가창 매매법.txt' 파일을 참고하여 호가창 매매법 적용
7. md_documents 폴더에 있는 '5일선 타법.txt' 파일을 참고하여 5일선 타법 적용


미국 주식 테마와 연관된 국내 주식 종목 검색.

관심종목 '피봇일목거래량돌파' 데이터 활용.

국내 주식 테마 및 종목 관련 뉴스 검색.

차트 데이터 수집 및 분석:

키움증권 REST API를 이용하여 검색된 종목의 일봉 차트 및 분봉 차트 데이터 불러오기.

일봉/분봉 차트 데이터 기반으로 종목명, 시가, 유통주식수, 테마를 목록화.

급등주 검색 (09:00 ~ 09:03):

전일 거래량 대비 50% 이상 상승한 종목 검색.

매매 전략:

일봉 차트 기준: 5일(또는 10일) 이동평균선을 4거래일 이상 이탈하지 않은 종목 우선 고려.

급등주 매매:

당일 전일 대비 거래량 100% 이상 상승 종목 대상.

매도 물량 분석: 매도 물량이 1~2틱 위 물량 (3틱부터 10틱까지 합한 물량)이 매수 물량 대비 약 2배 이상인 경우에만 매수/매도 진행.

모의 투자 연동:

모의 투자 계좌를 통한 시스템 테스트 및 검증.

자금 관리:

총 매수 금액: 1,000,000원.

한 종목당 최대 매수 금액: 100,000원.

손절 및 익절 설정:

매수 가격 대비 -2% 하락 시 자동 매도.

매수된 종목이 3% 이상 상승 후, 상승한 상태에서 -2% 하락 시 자동 매도.

3.2. 웹 인터페이스 (PHP)
자동매매 제어 기능:

자동매매 시작, 일시정지, 중지 버튼 구현.

차트 및 종목 정보 표시:

일봉 차트 화면 표시.

1분봉 차트 화면 표시.

미국 주식 상승률 상위 30위 종목, 테마, 뉴스 표시.

국내 주식 5일선 및 10일선 유지 종목 표시.

급등주 종목명 및 테마 표시.

매매 현황 표시:

실시간 매매 현황 (매수/매도 내역, 수익률 등) 표시.

손실(매도) 설정 기능:

사용자가 손실 매도 기준을 설정할 수 있는 기능 추가 (예: -2% 설정값 변경).

실시간 데이터 갱신:

모든 웹 화면의 데이터 자동 갱신.

국내 주식 실시간 상위 종목 (종목명, 상승률, 거래량, 테마, 뉴스) 데이터 업데이트 및 표시.

참고 문서 :
급등주거래량.txt
거래량 법칙.txt
키움 REST API 문서.pdf
호가창 매매법.txt
5일선 타법.txt

4. API 정보
API 키는 `config.ini` 파일에서 관리합니다. `.gitignore`에 등록되어 있으므로 해당 파일을 직접 확인해야 합니다.

5. 개발 로드맵 및 관리
버전 관리: Git을 활용한 코드 버전 관리.
작업을 진행할때 아레와 같이 한다.
파일에 현제 진행사항 및 업데이트 내용을 doc/ 폴더에 있는
drwxrwxr-x  2 stock stock 4096 Jul 19 08:04  .
drwxrwxr-x 11 stock stock 4096 Jul 19 07:49  ..
-rw-r--r--  1 stock stock 7641 Jul 19 08:04  20250718_작업할내용.txt
-rw-r--r--  1 stock stock 1079 Jul 18 16:49 '추가 내용.txt'
현제 진행사항은 20250718_작업할내용.txt
추가 내용.txt은 필요한 내용이 있을경우 추가되는 내용

### 사용법
시스템 설치 및 사용 방법에 대한 상세 내용은 추후 업데이트 예��입니다.

### 로드맵
본 프로젝트의 개발 로드맵은 '6. 개발 순서 (제안)' 섹션을 따릅니다. 각 단계별 상세 일정은 추후 확정됩니다.

### 목표
*   **단기 목표**: 키움증권 REST API 연동 모듈 개발 완료 및 미국/국내 주식 데이터 수집 및 분석 모듈의 초기 버전 구현.
*   **장기 목표**: 안정적인 자동매매 로직 구현 및 사용자 친화적인 웹 인터페이스 완성. 모의 투자를 통한 시스템 검증 및 실투자 적용 준비.

### 최근 완료된 주요 작업
*   **미국 주식 분석 시스템 데이터베이스 연동 (완료)**:
    *   기존의 JSON 파일 기반 데이터 처리 방식에서 SQLite 데이터베이스 기반으로 전환하여 데이터 관리의 효율성과 안정성을 높였습니다.
    *   `database.py`: `us_top_gainers` 테이블에 `sector`, `industry` 컬럼을 추가하고, 종목별 뉴스를 저장하기 위한 `us_stock_news` 테이블을 신규 생성하는 등 스키마를 업그레이드했습니다.
    *   `us_stock_analyzer.py`: FMP API나 백업 파일 대신, 데이터베이스에서 직접 상승률 상위 종목 목록을 조회하고, `yfinance`로 수집한 상세 정보와 뉴스를 다시 데이터베이스에 저장하도록 로직을 전면 개편했습니다.
*   **웹 인터페이스 기능 추가**:
    *   `index.php`에 "업데이트중" 메뉴를 추가하고 `updates.php` 페이지를 연결하여 작업 현황을 공유할 수 있는 기반을 마련했습니다.
*   **키움증권 API 연동 기능 개선**:
    *   모의투자 계좌 정보 조회 및 조건검색식 목록 조회 기능을 구현하고 안정화했습니다.
    *   주문 및 시세 조회 기능을 모듈화하여 (`kiwoom_api.py`) 코드의 재사용성을 높였습니다.


6. 개발 순서 (제안)
환경 설정: Python 및 PHP 개발 환경 구축, 키움���권 REST API 연동 준비.

API 연동 모듈 개발: 키움증권 REST API를 이용한 계좌 조회, 주문, 시세 조회 등 기본 기능 모듈화 (Python).

데이터 수집 및 분석 모듈 개발:

미국 주식 상승률 웹 스크래핑/API 연동 및 테마/뉴스 검색.

국내 주식 관심종목 데이터 연동 및 테마/뉴스 검색.

일봉/분봉 차트 데이터 수집 및 가공.

매매 전략 로직 구현:

급등주 검색 로직 구현.

5일/10일 이동평균선 이탈 여부 확인 로직 구현.

매도 물량 기반 매매 로직 구현.

손절/익절 로직 구현.

웹 인터페이스 기본 구조 개발 (PHP):

자동매매 제어 기능 (시작/일시정지/중지) 구현.

데이터를 표시할 기본 웹 페이지 레이아웃 구성.

데이터 연동 및 실시간 갱신:

Python 로직에서 처리된 데이터를 PHP 웹으로 전달 및 표시.

웹 페이지 자동 갱신 기능 구현.

UI/UX 개선 및 추가 기능 구현:

차트 시각화 (일봉/분봉 차트).

미국/국내 주식 정보 표시 UI 개선.

매매 현황 상세 표시.

손실 설정 기능 UI 구현.

테스트 및 디버깅: 모의 투자를 통한 시스템 전체 테스트 및 버그 수정.

문서화: 사용 설명서, 로드맵 등 문서 작성 및 업데이트.

## 배포 ���동화 테스트
## 최종 배포 자동화 테스트